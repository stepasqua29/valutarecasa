<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ValutaCasa â€” Calcolatore Immobiliare (IT/FR/DE)</title>
<meta name="description" content="Calcolatore immobiliare gratuito per Italia, Francia e Germania. Stima valore immobile con range e fattori di aggiustamento." />
<style>
  :root{
    --bg:#0b0f14; --card:#121821; --muted:#a7b3c2; --text:#eaf1f9; --accent:#5cc8ff; --accent2:#a0ffb3; --danger:#ff6b6b; --ok:#6bff95;
  }
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b0f14,#0e141c 40%,#0b0f14);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
  .brand{display:flex;gap:10px;align-items:center}
  .logo{width:40px;height:40px;border-radius:12px;background:radial-gradient(circle at 30% 30%,var(--accent),#2c7bb3 60%,#173a52 100%);box-shadow:0 0 30px #2c7bb380 inset, 0 10px 30px #0008}
  h1{font-size:1.4rem;margin:0}
  .card{background:var(--card);border:1px solid #203040;border-radius:16px;box-shadow:0 10px 30px #0008;padding:18px;margin:14px 0}
  .grid{display:grid;gap:12px}
  @media(min-width:880px){ .grid.cols-2{grid-template-columns:1fr 1fr} .grid.cols-3{grid-template-columns:repeat(3,1fr)} .grid.cols-4{grid-template-columns:repeat(4,1fr)} }
  label{display:block;font-size:.9rem;color:var(--muted);margin-bottom:6px}
  input,select,textarea{
    width:100%;background:#0c1219;border:1px solid #1e2b3a;border-radius:12px;color:var(--text);
    padding:12px 12px;font-size:1rem;outline:none;transition:border .15s ease, box-shadow .15s ease;
  }
  input:focus,select:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px #5cc8ff33}
  .row{display:grid;gap:12px}
  @media(min-width:640px){ .row.cols-2{grid-template-columns:1fr 1fr} .row.cols-3{grid-template-columns:repeat(3,1fr)} .row.cols-4{grid-template-columns:repeat(4,1fr)} }
  .actions{display:flex;gap:12px;flex-wrap:wrap}
  button{
    border:none;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer;
    background:linear-gradient(180deg,#27aae1,#1c84b3);color:#04131d;box-shadow:0 8px 20px #0af3;
  }
  button.secondary{background:#162130;color:var(--text);border:1px solid #24364a}
  button.ghost{background:transparent;border:1px dashed #36506b;color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;background:#0e1722;border:1px solid #213447;font-size:.9rem;color:var(--muted)}
  .kpi{display:grid;gap:12px}
  @media(min-width:820px){ .kpi{grid-template-columns:repeat(3,1fr)}}
  .kpi .c{background:#0f1722;border:1px solid #1b2a3b;border-radius:16px;padding:16px}
  .kpi h3{margin:0 0 6px 0;font-size:.95rem;color:var(--muted)}
  .kpi .v{font-size:1.6rem;font-weight:800}
  .ok{color:var(--ok)} .bad{color:var(--danger)} .muted{color:var(--muted)}
  .hr{height:1px;background:#1e2b33;margin:12px 0}
  small{color:var(--muted)}
  .tag{display:inline-block;padding:4px 10px;border:1px solid #2a425a;border-radius:999px;color:#b9c6d6;font-size:.8rem;margin-right:8px}
  .note{font-size:.9rem;color:#cbd7e6}
  .right{margin-left:auto}
  .footer{font-size:.85rem;color:#99a8b9}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>ValutaCasa â€¢ Calcolatore Immobiliare</h1>
        <div class="muted">Stima istantanea per Italia, Francia, Germania â€¢ v1.0 statico (no build)</div>
      </div>
    </div>
    <div class="pill">ðŸ‡®ðŸ‡¹ ðŸ‡«ðŸ‡· ðŸ‡©ðŸ‡ª <span class="muted">Multi-Paese</span></div>
  </header>

  <form id="form" class="card" novalidate>
    <h2 style="margin-top:0">Dati immobile</h2>

    <div class="grid cols-3">
      <div>
        <label for="country">Paese</label>
        <select id="country" required>
          <option value="IT">Italia</option>
          <option value="FR">Francia</option>
          <option value="DE">Germania</option>
        </select>
      </div>
      <div>
        <label for="tier">Area / Tier cittÃ </label>
        <select id="tier" required>
          <option value="tier1">Tier 1 (capitali / prime)</option>
          <option value="tier2" selected>Tier 2 (medie)</option>
          <option value="tier3">Tier 3 (piccole / periferiche)</option>
        </select>
        <small class="muted">Serve a calibrare â‚¬/mÂ² baseline</small>
      </div>
      <div>
        <label for="city">CittÃ  / Comune</label>
        <input id="city" placeholder="es. Torino, Lione, Monaco di Baviera" />
      </div>
    </div>

    <div class="grid cols-3">
      <div>
        <label for="address">Via / Indirizzo</label>
        <input id="address" placeholder="Via, civico" />
      </div>
      <div>
        <label for="cap">CAP / Codice postale</label>
        <input id="cap" inputmode="numeric" pattern="\\d{4,6}" placeholder="es. 10100" />
      </div>
      <div>
        <label for="province">Provincia / Dipartimento (opz.)</label>
        <input id="province" placeholder="TO, RhÃ´ne, BYâ€¦" />
      </div>
    </div>

    <div class="row cols-4">
      <div>
        <label for="sqm">Superficie (mÂ²)</label>
        <input id="sqm" type="number" min="10" step="1" required placeholder="mÂ²" />
      </div>
      <div>
        <label for="bed">Camere</label>
        <input id="bed" type="number" min="0" step="1" value="2" />
      </div>
      <div>
        <label for="bath">Bagni</label>
        <input id="bath" type="number" min="1" step="1" value="1" />
      </div>
      <div>
        <label for="box">Box/Posto auto (nÂ°)</label>
        <input id="box" type="number" min="0" step="1" value="0" />
      </div>
    </div>

    <div class="row cols-4">
      <div>
        <label for="floor">Piano</label>
        <select id="floor">
          <option value="-1">Seminterrato</option>
          <option value="0">Terra</option>
          <option value="1" selected>1</option>
          <option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5+</option>
        </select>
      </div>
      <div>
        <label for="elevator">Ascensore</label>
        <select id="elevator">
          <option value="yes">SÃ¬</option>
          <option value="no">No</option>
        </select>
      </div>
      <div>
        <label for="year">Anno costruzione</label>
        <input id="year" type="number" min="1900" max="2025" value="1985" />
      </div>
      <div>
        <label for="condition">Stato immobile</label>
        <select id="condition">
          <option value="new">Nuovo/Recente</option>
          <option value="renovated" selected>Ristrutturato</option>
          <option value="good">Usato buono</option>
          <option value="tobe">Da ristrutturare</option>
        </select>
      </div>
    </div>

    <div class="row cols-3">
      <div>
        <label for="energy">Classe energetica</label>
        <select id="energy">
          <option value="A4">A4</option><option value="A3">A3</option><option value="A2">A2</option>
          <option value="A">A</option><option value="B">B</option><option value="C">C</option>
          <option value="D" selected>D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option>
        </select>
      </div>
      <div>
        <label for="balcony">Balconi/Terrazzi (mÂ²)</label>
        <input id="balcony" type="number" min="0" step="1" value="0" />
      </div>
      <div>
        <label for="garden">Giardino (mÂ²)</label>
        <input id="garden" type="number" min="0" step="1" value="0" />
      </div>
    </div>

    <div class="row cols-3">
      <div>
        <label for="exposure">Esposizione</label>
        <select id="exposure">
          <option value="single">Singola</option>
          <option value="double" selected>Doppia</option>
          <option value="triple">Tripla/Angolare</option>
        </select>
      </div>
      <div>
        <label for="view">Vista</label>
        <select id="view">
          <option value="none" selected>Nessuna</option>
          <option value="sea">Mare</option>
          <option value="mountain">Montagna</option>
          <option value="city">CittÃ /Skyline</option>
        </select>
      </div>
      <div>
        <label for="noise">Rumore</label>
        <select id="noise">
          <option value="low" selected>Basso</option>
          <option value="mid">Medio</option>
          <option value="high">Alto</option>
        </select>
      </div>
    </div>

    <div>
      <label for="notes">Note / Dettagli rilevanti (opz.)</label>
      <textarea id="notes" rows="3" placeholder="Es. finiture di pregio 2023, bagno rifatto, cappotto interno, tetto nuovoâ€¦"></textarea>
    </div>

    <div class="hr"></div>

    <h3 style="margin-top:0">Contatti (per ricevere il report)</h3>
    <div class="row cols-3">
      <div>
        <label for="name">Nome e Cognome</label>
        <input id="name" placeholder="Es. Michele Pasqualino" />
      </div>
      <div>
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="nome@dominio.it" />
      </div>
      <div>
        <label for="phone">Telefono</label>
        <input id="phone" inputmode="tel" placeholder="+39â€¦" />
      </div>
    </div>
    <div style="margin:8px 0">
      <label style="display:flex;gap:10px;align-items:flex-start">
        <input id="privacy" type="checkbox" style="width:18px;height:18px;margin-top:2px" />
        <span class="muted">Acconsento al trattamento dei dati per ricontatto e invio del report.</span>
      </label>
    </div>

    <div class="actions">
      <button type="button" id="calcBtn">Calcola Valore</button>
      <button type="button" id="saveBtn" class="secondary">Salva/Continua dopo</button>
      <button type="reset" class="ghost">Reset</button>
      <div class="right tag">Tutti i calcoli avvengono sul tuo browser</div>
    </div>
  </form>

  <section id="resultCard" class="card" style="display:none">
    <h2 style="margin-top:0">Risultato stima</h2>
    <div id="tags"></div>
    <div class="kpi" style="margin-top:12px">
      <div class="c">
        <h3>Valore Low (âˆ’8%)</h3>
        <div class="v" id="lowVal">â€”</div>
      </div>
      <div class="c">
        <h3>Valore Likely</h3>
        <div class="v ok" id="midVal">â€”</div>
      </div>
      <div class="c">
        <h3>Valore High (+8%)</h3>
        <div class="v" id="highVal">â€”</div>
      </div>
    </div>
    <div style="margin-top:14px" class="grid cols-3">
      <div class="c">
        <h3>â‚¬/mÂ² base â†’ finale</h3>
        <div class="v" id="euroMq">â€”</div>
        <small id="euroMqNote" class="muted"></small>
      </div>
      <div class="c">
        <h3>Metri accessori</h3>
        <div class="v" id="accessori">â€”</div>
        <small class="muted">Valorizzati con coeff. (terrazzi/giardini)</small>
      </div>
      <div class="c">
        <h3>Box/Posti auto</h3>
        <div class="v" id="boxVal">â€”</div>
        <small class="muted">Aggiunta a corpo</small>
      </div>
    </div>

    <div class="hr"></div>
    <p class="note">
      La stima Ã¨ indicativa e basata su baseline â‚¬/mÂ² per paese e tier cittÃ  con
      aggiustamenti (etÃ , stato, classe energetica, piano/ascensore, esposizione, vista, rumorositÃ , pertinenze).
      Non sostituisce una perizia. Invia i dati e ti contattiamo per rifinirla con comparabili reali.
    </p>

    <div class="actions">
      <button id="exportBtn" type="button">Esporta JSON</button>
      <a id="downloadLink" class="pill" style="display:none" download="valutazione.json">Scarica valutazione.json</a>
      <button id="printBtn" class="secondary" type="button">Stampa / PDF</button>
    </div>
  </section>

  <footer class="wrap footer" style="padding-bottom:24px">
    Â© <span id="yy"></span> ValutaCasa â€¢ Demo calcolatore statico â€¢ Built for Michele
  </footer>
</div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const nowYear = new Date().getFullYear();
  $("yy").textContent = nowYear;

  // Baseline â‚¬/mÂ² per paese+tier (seleziona quella che vuoi ottimizzare)
  const BASE = {
    IT: { tier1: 4000, tier2: 2500, tier3: 1500 },
    FR: { tier1: 6000, tier2: 3500, tier3: 2200 },
    DE: { tier1: 5500, tier2: 3200, tier3: 2000 }
  };

  // Valore a corpo per box/posto auto (stima conservativa)
  const BOX_VALUE = { IT: 12000, FR: 15000, DE: 14000 };

  // Coefficienti superficie accessoria
  const COEFF = { balcony: 0.15, garden: 0.10 };

  // Impatto % per classe energetica
  const ENERGY_MAP = {
    A4: 0.12, A3: 0.11, A2: 0.105, A: 0.10, B: 0.08, C: 0.04,
    D: 0.00, E: -0.05, F: -0.09, G: -0.14
  };

  // Stato immobile
  const COND_MAP = { new: 0.10, renovated: 0.05, good: 0.00, tobe: -0.15 };

  // Vista
  const VIEW_MAP = { none: 0.00, sea: 0.05, mountain: 0.03, city: 0.02 };

  // Rumore
  const NOISE_MAP = { low: 0.00, mid: -0.03, high: -0.07 };

  // Esposizione
  const EXP_MAP = { single: -0.02, double: 0.00, triple: 0.02 };

  // Piano/Ascensore
  function floorFactor(floor, elev){
    let f = 0;
    if(floor === -1) f -= 0.12;
    if(floor === 0) f -= 0.02;
    if(floor === 1) f += 0.00;
    if(floor === 2) f += 0.01;
    if(floor === 3) f += 0.02;
    if(floor >= 4) f += 0.03;
    if(elev === "no" && floor >= 3) f -= 0.06; // penalitÃ  senza ascensore
    return f;
  }

  function fmtEUR(x){
    return x.toLocaleString("it-IT",{style:"currency",currency:"EUR",maximumFractionDigits:0});
  }

  function clamp(x,min,max){ return Math.max(min, Math.min(max, x)); }

  function compute(){
    // Validate essentials
    const sqm = parseFloat($("sqm").value);
    if(!sqm || sqm < 10){ alert("Inserisci una superficie valida (mÂ²)."); return; }

    const country = $("country").value;
    const tier = $("tier").value;
    let euroMq = BASE[country][tier];

    const year = parseInt($("year").value || "1980",10);
    const age = clamp(nowYear - year, 0, 80);
    let ageFactor = 1 - Math.min(age,60) * 0.005; // fino a -30% a 60 anni
    // Lo stato puÃ² compensare parzialmente l'etÃ 
    const cond = $("condition").value;
    const condDelta = COND_MAP[cond] || 0;

    const energy = $("energy").value;
    const energyDelta = ENERGY_MAP[energy] ?? 0;

    const floor = parseInt($("floor").value,10);
    const elev = $("elevator").value;
    const floorDelta = floorFactor(floor, elev);

    const exposureDelta = EXP_MAP[$("exposure").value] || 0;
    const viewDelta = VIEW_MAP[$("view").value] || 0;
    const noiseDelta = NOISE_MAP[$("noise").value] || 0;

    const bath = parseInt($("bath").value||"1",10);
    const bed  = parseInt($("bed").value||"2",10);
    const boxN = parseInt($("box").value||"0",10);

    const balcony = parseFloat($("balcony").value||"0");
    const garden  = parseFloat($("garden").value||"0");

    // Micro-impatti
    const bathDelta = Math.max(0, (bath-1)) * 0.02; // +2% per bagno extra
    const bedDelta  = clamp(Math.max(0, (bed-1))*0.01, 0, 0.03); // +1% per camera extra, max +3%

    // Delta totale percentuale (compositivo)
    const totalPct =
      (ageFactor - 1) + // giÃ  in forma "moltiplicativa", convertiamolo in delta additivo
      condDelta + energyDelta + floorDelta + exposureDelta +
      viewDelta + noiseDelta + bathDelta + bedDelta;

    // â‚¬/mÂ² finale
    const euroMqFinal = euroMq * (1 + totalPct);

    // Superfici accessorie valorizzate
    const valAccessori = (balcony * euroMqFinal * COEFF.balcony) + (garden * euroMqFinal * COEFF.garden);

    // Box a corpo
    const boxVal = boxN * BOX_VALUE[country];

    // Valore principale
    const baseVal = euroMqFinal * sqm;
    const tot = baseVal + valAccessori + boxVal;

    // Range Â±8%
    const low = tot * 0.92;
    const high = tot * 1.08;

    // Output
    $("resultCard").style.display = "block";
    $("lowVal").textContent  = fmtEUR(low);
    $("midVal").textContent  = fmtEUR(tot);
    $("highVal").textContent = fmtEUR(high);
    $("euroMq").textContent  = fmtEUR(euroMq) + " â†’ " + fmtEUR(euroMqFinal) + " /mÂ²";
    $("euroMqNote").textContent = `Base ${country}Â·${tier.toUpperCase()} con ${Math.round(totalPct*100)}% di aggiustamenti`;
    $("accessori").textContent = fmtEUR(valAccessori);
    $("boxVal").textContent    = fmtEUR(boxVal);

    // Tag riepilogo
    const tags = [
      $("country").value, $("tier").value, `${sqm} mÂ²`,
      `${bed} camere`, `${bath} bagni`,
      `stato:${cond}`, `classe:${energy}`,
      `piano:${$("floor").value}/${$("elevator").value==='yes'?'asc':''}`,
      $("exposure").value, $("view").value, `rumore:${$("noise").value}`
    ];
    const tagsEl = $("tags");
    tagsEl.innerHTML = "";
    tags.forEach(t=>{
      const s = document.createElement("span"); s.className="tag"; s.textContent=t; tagsEl.appendChild(s);
    });

    // Ritorna dati per export
    return {
      inputs: collectFormData(),
      calcolo: {
        euroMqBase: euroMq, euroMqFinal: Math.round(euroMqFinal),
        valAccessori: Math.round(valAccessori),
        boxVal: Math.round(boxVal),
        totaleLikely: Math.round(tot),
        low: Math.round(low), high: Math.round(high),
        deltaPercent: Math.round(totalPct*100)
      }
    };
  }

  function collectFormData(){
    return {
      country: $("country").value,
      tier: $("tier").value,
      city: $("city").value,
      address: $("address").value,
      cap: $("cap").value,
      province: $("province").value,
      sqm: parseFloat($("sqm").value||""),
      bed: parseInt($("bed").value||""),
      bath: parseInt($("bath").value||""),
      box: parseInt($("box").value||""),
      floor: $("floor").value,
      elevator: $("elevator").value,
      year: $("year").value,
      condition: $("condition").value,
      energy: $("energy").value,
      balcony: parseFloat($("balcony").value||"0"),
      garden: parseFloat($("garden").value||"0"),
      exposure: $("exposure").value,
      view: $("view").value,
      noise: $("noise").value,
      notes: $("notes").value,
      contact: {
        name: $("name").value,
        email: $("email").value,
        phone: $("phone").value,
        privacy: $("privacy").checked
      },
      timestamp: new Date().toISOString()
    };
  }

  function saveDraft(){
    const data = collectFormData();
    localStorage.setItem("valutacasa_draft", JSON.stringify(data));
    alert("Bozza salvata sul dispositivo.");
  }

  function restoreDraft(){
    try{
      const raw = localStorage.getItem("valutacasa_draft");
      if(!raw) return;
      const d = JSON.parse(raw);
      for(const [k,v] of Object.entries(d)){
        if(k==="contact"||k==="timestamp") continue;
        if($(k)){ $(k).value = v; }
      }
      if(d.contact){
        $("name").value = d.contact.name||"";
        $("email").value = d.contact.email||"";
        $("phone").value = d.contact.phone||"";
        $("privacy").checked = !!d.contact.privacy;
      }
    }catch(e){}
  }

  function exportJSON(payload){
    const blob = new Blob([JSON.stringify(payload,null,2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = $("downloadLink");
    a.href = url;
    a.style.display = "inline-flex";
  }

  $("calcBtn").addEventListener("click", ()=>{
    const out = compute();
    if(out){
      const payload = { ...out, meta: { app:"ValutaCasa", version:"1.0", createdAt:new Date().toISOString() } };
      exportJSON(payload);
    }
  });

  $("saveBtn").addEventListener("click", saveDraft);
  $("exportBtn").addEventListener("click", ()=>{
    const out = compute();
    if(out){
      const payload = { ...out, meta: { app:"ValutaCasa", version:"1.0", createdAt:new Date().toISOString() } };
      exportJSON(payload);
      alert("JSON pronto. Clicca il pulsante 'Scarica valutazione.json'.");
    }
  });

  $("printBtn").addEventListener("click", ()=>window.print());

  // Ripristina eventuale bozza
  restoreDraft();
})();
</script>
</body>
</html>
